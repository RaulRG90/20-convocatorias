import { Component, Output, EventEmitter, Input } from '@angular/core';
import { MDBModalService } from 'angular-bootstrap-md';
import { EventModalComponent } from '../event-modal/event-modal.component';
import { CalendarView } from '../../utils/calendar-view';
import { take } from 'rxjs/operators';
import { format, getYear, getMonth, getDate } from 'date-fns';
export class MdbCalendarComponent {
    constructor(modalService) {
        this.modalService = modalService;
        this.weekDaysDefault = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        this.weekDaysShortDefault = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        this.monthsDefault = [
            'January',
            'February',
            'March',
            'April',
            'May',
            'June',
            'July',
            'August',
            'September',
            'October',
            'November',
            'December',
        ];
        this.monthsShortDefault = [
            'Jan',
            'Feb',
            'Mar',
            'Apr',
            'May',
            'Jun',
            'Jul',
            'Aug',
            'Sep',
            'Oct',
            'Nov',
            'Dec',
        ];
        this.calendarOptions = {
            firstDayOfWeek: 'Sunday',
            monthViewBtnTxt: 'Month',
            weekViewBtnTxt: 'Week',
            listViewBtnTxt: 'List',
            todayBtnTxt: 'Today',
            eventAddTitle: 'Add new event',
            eventEditTitle: 'Edit event',
            eventCancelBtnTxt: 'Cancel',
            eventAddBtnTxt: 'Add',
            eventEditBtnTxt: 'Edit',
            eventDeleteBtnTxt: 'Delete',
        };
        this.dayLabels = [];
        this.dayLabelsShort = [];
        this.startDate = new Date();
        this.events = [];
        this.editable = true;
        this.weekDays = this.weekDaysDefault;
        this.weekDaysShort = this.weekDaysShortDefault;
        this.months = this.monthsDefault;
        this.monthsShort = this.monthsShortDefault;
        this.eventDeleted = new EventEmitter();
        this.eventEdited = new EventEmitter();
        this.eventAdded = new EventEmitter();
        this.monthChanged = new EventEmitter();
        this.weekChanged = new EventEmitter();
        this.listChanged = new EventEmitter();
        this.viewChanged = new EventEmitter();
        this.MS_IN_DAY = 24 * 60 * 60 * 1000;
        this.view = CalendarView;
        this.currentView = this.view.month;
        this._isInitialized = false;
    }
    ngOnInit() {
        this.calendarOptions = this.options
            ? Object.assign(this.calendarOptions, this.options)
            : this.calendarOptions;
        this._changeDaysOrder();
        if (this.defaultView) {
            this.onViewChange(this.defaultView);
        }
        this._isInitialized = true;
    }
    _changeDaysOrder() {
        const dayIndex = (this.weekDayIndex = this.weekDaysDefault.indexOf(this.calendarOptions.firstDayOfWeek));
        if (dayIndex !== -1) {
            let index = dayIndex;
            for (let i = 0; i < this.weekDays.length; i++) {
                this.dayLabels.push(this.weekDays[index]);
                this.dayLabelsShort.push(this.weekDaysShort[index]);
                index = this.weekDaysDefault[index] === 'Saturday' ? 0 : index + 1;
            }
        }
    }
    getFormattedEvent(event) {
        return {
            id: event.id,
            name: event.name,
            startDate: format(event.startDate, 'YYYY-MM-DD, HH:mm:ss'),
            endDate: format(event.endDate, 'YYYY-MM-DD, HH:mm:ss'),
            color: event.color,
        };
    }
    formatDate(date) {
        const year = getYear(date);
        const month = getMonth(date);
        const day = getDate(date);
    }
    onDayClick(day) {
        if (this.editable) {
            this.openAddModal(day);
        }
    }
    onEventClick(event) {
        this.openEditModal(event);
    }
    onViewChange(view) {
        this.currentView = this.view[view];
        this.viewChanged.emit(view);
    }
    onMonthChange(event) {
        this.monthChanged.emit(event);
    }
    onWeekChange(event) {
        this.weekChanged.emit(event);
    }
    onListChange(event) {
        this.listChanged.emit(event);
    }
    openAddModal(event) {
        const data = {
            title: this.calendarOptions.eventAddTitle,
            actionBtn: this.calendarOptions.eventAddBtnTxt,
            cancelBtn: this.calendarOptions.eventCancelBtnTxt,
            mode: 'add',
            editable: this.editable,
            event: this.getFormattedEvent(event),
        };
        this.modalRef = this.modalService.show(EventModalComponent, { data });
        this.modalRef.content.eventData.pipe(take(1)).subscribe((newEvent) => {
            this.eventAdded.emit(newEvent);
        });
    }
    openEditModal(event) {
        const data = {
            title: this.calendarOptions.eventEditTitle,
            actionBtn: this.calendarOptions.eventEditBtnTxt,
            cancelBtn: this.calendarOptions.eventDeleteBtnTxt,
            mode: 'edit',
            editable: this.editable,
            event: event,
        };
        this.modalRef = this.modalService.show(EventModalComponent, { data });
        this.modalRef.content.eventData.pipe(take(1)).subscribe((editedEvent) => {
            this.eventEdited.emit(editedEvent);
        });
        this.modalRef.content.eventDeleted.pipe(take(1)).subscribe((deletedEvent) => {
            this.eventDeleted.emit(deletedEvent);
        });
    }
}
MdbCalendarComponent.decorators = [
    { type: Component, args: [{
                selector: 'mdb-calendar',
                template: "<div class=\"mdb-calendar\" [ngSwitch]=\"currentView\">\n  <mdb-calendar-month-view\n    *ngSwitchCase=\"view.month\"\n    [initDate]=\"startDate\"\n    [events]=\"events\"\n    [options]=\"calendarOptions\"\n    [weekDaysShort]=\"dayLabelsShort\"\n    [weekDayIndex]=\"weekDayIndex\"\n    [months]=\"months\"\n    (dayClicked)=\"onDayClick($event)\"\n    (eventClicked)=\"onEventClick($event)\"\n    (viewChanged)=\"onViewChange($event)\"\n    (monthChanged)=\"onMonthChange($event)\"\n  >\n  </mdb-calendar-month-view>\n\n  <mdb-calendar-week-view\n    *ngSwitchCase=\"view.week\"\n    [initDate]=\"startDate\"\n    [events]=\"events\"\n    [options]=\"calendarOptions\"\n    [weekDaysShort]=\"weekDaysShort\"\n    [weekDayIndex]=\"weekDayIndex\"\n    [monthsShort]=\"monthsShort\"\n    (dateClicked)=\"onDayClick($event)\"\n    (eventClicked)=\"onEventClick($event)\"\n    (viewChanged)=\"onViewChange($event)\"\n    (weekChanged)=\"onWeekChange($event)\"\n  >\n  </mdb-calendar-week-view>\n\n  <mdb-calendar-list-view\n    *ngSwitchCase=\"view.list\"\n    [initDate]=\"startDate\"\n    [events]=\"events\"\n    [options]=\"calendarOptions\"\n    [weekDayIndex]=\"weekDayIndex\"\n    [monthsShort]=\"monthsShort\"\n    (eventClicked)=\"onEventClick($event)\"\n    (viewChanged)=\"onViewChange($event)\"\n    (listChanged)=\"onListChange($event)\"\n  >\n  </mdb-calendar-list-view>\n</div>\n",
                styles: ["@media (max-width: 992px){::ng-deep .mdb-calendar-tools{flex-direction:column}::ng-deep .mdb-calendar-tools .mdb-calendar-heading{text-align:center;order:-1}::ng-deep .mdb-calendar-tools>.btn-group{transform:scale(.9)}}\n"]
            },] }
];
MdbCalendarComponent.ctorParameters = () => [
    { type: MDBModalService }
];
MdbCalendarComponent.propDecorators = {
    startDate: [{ type: Input }],
    events: [{ type: Input }],
    options: [{ type: Input }],
    editable: [{ type: Input }],
    weekDays: [{ type: Input }],
    weekDaysShort: [{ type: Input }],
    months: [{ type: Input }],
    monthsShort: [{ type: Input }],
    defaultView: [{ type: Input }],
    eventDeleted: [{ type: Output }],
    eventEdited: [{ type: Output }],
    eventAdded: [{ type: Output }],
    monthChanged: [{ type: Output }],
    weekChanged: [{ type: Output }],
    listChanged: [{ type: Output }],
    viewChanged: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbWRiLWNhbGVuZGFyL3NyYy9saWIvY29tcG9uZW50cy9jYWxlbmRhci9jYWxlbmRhci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxNQUFNLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUUvRSxPQUFPLEVBQUUsZUFBZSxFQUFlLE1BQU0sc0JBQXNCLENBQUM7QUFDcEUsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFDM0UsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ3pELE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN0QyxPQUFPLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBUTlELE1BQU0sT0FBTyxvQkFBb0I7SUE2RS9CLFlBQW9CLFlBQTZCO1FBQTdCLGlCQUFZLEdBQVosWUFBWSxDQUFpQjtRQTVFakQsb0JBQWUsR0FBRyxDQUFDLFFBQVEsRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBQ2pHLHlCQUFvQixHQUFHLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDekUsa0JBQWEsR0FBRztZQUNkLFNBQVM7WUFDVCxVQUFVO1lBQ1YsT0FBTztZQUNQLE9BQU87WUFDUCxLQUFLO1lBQ0wsTUFBTTtZQUNOLE1BQU07WUFDTixRQUFRO1lBQ1IsV0FBVztZQUNYLFNBQVM7WUFDVCxVQUFVO1lBQ1Ys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QkFDTCxLQUFLOzBCQUNMLEtBQUs7MkJBQ0wsTUFBTTswQkFDTixNQUFNO3lCQUNOLE1BQU07MkJBRU4sTUFBTTswQkFDTixNQUFNOzBCQUNOLE1BQU07MEJBQ04sTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgSW5wdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENhbGVuZGFyRXZlbnQgfSBmcm9tICcuLi8uLi9pbnRlcmZhY2VzL2NhbGVuZGFyLWV2ZW50LmludGVyZmFjZSc7XG5pbXBvcnQgeyBNREJNb2RhbFNlcnZpY2UsIE1EQk1vZGFsUmVmIH0gZnJvbSAnYW5ndWxhci1ib290c3RyYXAtbWQnO1xuaW1wb3J0IHsgRXZlbnRNb2RhbENvbXBvbmVudCB9IGZyb20gJy4uL2V2ZW50LW1vZGFsL2V2ZW50LW1vZGFsLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBDYWxlbmRhclZpZXcgfSBmcm9tICcuLi8uLi91dGlscy9jYWxlbmRhci12aWV3JztcbmltcG9ydCB7IHRha2UgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBmb3JtYXQsIGdldFllYXIsIGdldE1vbnRoLCBnZXREYXRlIH0gZnJvbSAnZGF0ZS1mbnMnO1xuaW1wb3J0IHsgTWRiQ2FsZW5kYXJPcHRpb25zIH0gZnJvbSAnLi4vLi4vaW50ZXJmYWNlcy9jYWxlbmRhci1vcHRpb25zLmludGVyZmFjZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ21kYi1jYWxlbmRhcicsXG4gIHRlbXBsYXRlVXJsOiAnLi9jYWxlbmRhci5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2NhbGVuZGFyLmNvbXBvbmVudC5zY3NzJ10sXG59KVxuZXhwb3J0IGNsYXNzIE1kYkNhbGVuZGFyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgd2Vla0RheXNEZWZhdWx0ID0gWydTdW5kYXknLCAnTW9uZGF5JywgJ1R1ZXNkYXknLCAnV2VkbmVzZGF5JywgJ1RodXJzZGF5JywgJ0ZyaWRheScsICdTYXR1cmRheSddO1xuICB3ZWVrRGF5c1Nob3J0RGVmYXVsdCA9IFsnU3VuJywgJ01vbicsICdUdWUnLCAnV2VkJywgJ1RodScsICdGcmknLCAnU2F0J107XG4gIG1vbnRoc0RlZmF1bHQgPSBbXG4gICAgJ0phbnVhcnknLFxuICAgICdGZWJydWFyeScsXG4gICAgJ01hcmNoJyxcbiAgICAnQXByaWwnLFxuICAgICdNYXknLFxuICAgICdKdW5lJyxcbiAgICAnSnVseScsXG4gICAgJ0F1Z3VzdCcsXG4gICAgJ1NlcHRlbWJlcicsXG4gICAgJ09jdG9iZXInLFxuICAgICdOb3ZlbWJlcicsXG4gICAgJ0RlY2VtYmVyJyxcbiAgXTtcbiAgbW9udGhzU2hvcnREZWZhdWx0ID0gW1xuICAgICdKYW4nLFxuICAgICdGZWInLFxuICAgICdNYXInLFxuICAgICdBcHInLFxuICAgICdNYXknLFxuICAgICdKdW4nLFxuICAgICdKdWwnLFxuICAgICdBdWcnLFxuICAgICdTZXAnLFxuICAgICdPY3QnLFxuICAgICdOb3YnLFxuICAgICdEZWMnLFxuICBdO1xuXG4gIGNhbGVuZGFyT3B0aW9uczogTWRiQ2FsZW5kYXJPcHRpb25zID0ge1xuICAgIGZpcnN0RGF5T2ZXZWVrOiAnU3VuZGF5JyxcbiAgICBtb250aFZpZXdCdG5UeHQ6ICdNb250aCcsXG4gICAgd2Vla1ZpZXdCdG5UeHQ6ICdXZWVrJyxcbiAgICBsaXN0Vmlld0J0blR4dDogJ0xpc3QnLFxuICAgIHRvZGF5QnRuVHh0OiAnVG9kYXknLFxuICAgIGV2ZW50QWRkVGl0bGU6ICdBZGQgbmV3IGV2ZW50JyxcbiAgICBldmVudEVkaXRUaXRsZTogJ0VkaXQgZXZlbnQnLFxuICAgIGV2ZW50Q2FuY2VsQnRuVHh0OiAnQ2FuY2VsJyxcbiAgICBldmVudEFkZEJ0blR4dDogJ0FkZCcsXG4gICAgZXZlbnRFZGl0QnRuVHh0OiAnRWRpdCcsXG4gICAgZXZlbnREZWxldGVCdG5UeHQ6ICdEZWxldGUnLFxuICB9O1xuXG4gIGRheUxhYmVsczogc3RyaW5nW10gPSBbXTtcbiAgZGF5TGFiZWxzU2hvcnQ6IHN0cmluZ1tdID0gW107XG4gIHdlZWtEYXlJbmRleDogbnVtYmVyO1xuXG4gIEBJbnB1dCgpIHN0YXJ0RGF0ZTogRGF0ZSA9IG5ldyBEYXRlKCk7XG4gIEBJbnB1dCgpIGV2ZW50czogQ2FsZW5kYXJFdmVudFtdID0gW107XG4gIEBJbnB1dCgpIG9wdGlvbnM6IE1kYkNhbGVuZGFyT3B0aW9ucztcbiAgQElucHV0KCkgZWRpdGFibGUgPSB0cnVlO1xuICBASW5wdXQoKSB3ZWVrRGF5czogc3RyaW5nW10gPSB0aGlzLndlZWtEYXlzRGVmYXVsdDtcbiAgQElucHV0KCkgd2Vla0RheXNTaG9ydDogc3RyaW5nW10gPSB0aGlzLndlZWtEYXlzU2hvcnREZWZhdWx0O1xuICBASW5wdXQoKSBtb250aHM6IHN0cmluZ1tdID0gdGhpcy5tb250aHNEZWZhdWx0O1xuICBASW5wdXQoKSBtb250aHNTaG9ydDogc3RyaW5nW10gPSB0aGlzLm1vbnRoc1Nob3J0RGVmYXVsdDtcbiAgQElucHV0KCkgZGVmYXVsdFZpZXc6IENhbGVuZGFyVmlldztcbiAgQE91dHB1dCgpIGV2ZW50RGVsZXRlZCA9IG5ldyBFdmVudEVtaXR0ZXI8Q2FsZW5kYXJFdmVudD4oKTtcbiAgQE91dHB1dCgpIGV2ZW50RWRpdGVkID0gbmV3IEV2ZW50RW1pdHRlcjxDYWxlbmRhckV2ZW50PigpO1xuICBAT3V0cHV0KCkgZXZlbnRBZGRlZCA9IG5ldyBFdmVudEVtaXR0ZXI8Q2FsZW5kYXJFdmVudD4oKTtcblxuICBAT3V0cHV0KCkgbW9udGhDaGFuZ2VkID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoKSB3ZWVrQ2hhbmdlZCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCkgbGlzdENoYW5nZWQgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgpIHZpZXdDaGFuZ2VkID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XG5cbiAgbW9kYWxSZWY6IE1EQk1vZGFsUmVmO1xuICBNU19JTl9EQVkgPSAyNCAqIDYwICogNjAgKiAxMDAwO1xuXG4gIHZpZXcgPSBDYWxlbmRhclZpZXc7XG5cbiAgY3VycmVudFZpZXc6IENhbGVuZGFyVmlldyA9IHRoaXMudmlldy5tb250aDtcblxuICBwcml2YXRlIF9pc0luaXRpYWxpemVkID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBtb2RhbFNlcnZpY2U6IE1EQk1vZGFsU2VydmljZSkge31cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmNhbGVuZGFyT3B0aW9ucyA9IHRoaXMub3B0aW9uc1xuICAgICAgPyBPYmplY3QuYXNzaWduKHRoaXMuY2FsZW5kYXJPcHRpb25zLCB0aGlzLm9wdGlvbnMpXG4gICAgICA6IHRoaXMuY2FsZW5kYXJPcHRpb25zO1xuICAgIHRoaXMuX2NoYW5nZURheXNPcmRlcigpO1xuICAgIGlmICh0aGlzLmRlZmF1bHRWaWV3KSB7XG4gICAgICB0aGlzLm9uVmlld0NoYW5nZSh0aGlzLmRlZmF1bHRWaWV3KTtcbiAgICB9XG5cbiAgICB0aGlzLl9pc0luaXRpYWxpemVkID0gdHJ1ZTtcbiAgfVxuXG4gIHByaXZhdGUgX2NoYW5nZURheXNPcmRlcigpIHtcbiAgICBjb25zdCBkYXlJbmRleCA9ICh0aGlzLndlZWtEYXlJbmRleCA9IHRoaXMud2Vla0RheXNEZWZhdWx0LmluZGV4T2YoXG4gICAgICB0aGlzLmNhbGVuZGFyT3B0aW9ucy5maXJzdERheU9mV2Vla1xuICAgICkpO1xuXG4gICAgaWYgKGRheUluZGV4ICE9PSAtMSkge1xuICAgICAgbGV0IGluZGV4ID0gZGF5SW5kZXg7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMud2Vla0RheXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdGhpcy5kYXlMYWJlbHMucHVzaCh0aGlzLndlZWtEYXlzW2luZGV4XSk7XG4gICAgICAgIHRoaXMuZGF5TGFiZWxzU2hvcnQucHVzaCh0aGlzLndlZWtEYXlzU2hvcnRbaW5kZXhdKTtcbiAgICAgICAgaW5kZXggPSB0aGlzLndlZWtEYXlzRGVmYXVsdFtpbmRleF0gPT09ICdTYXR1cmRheScgPyAwIDogaW5kZXggKyAxO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGdldEZvcm1hdHRlZEV2ZW50KGV2ZW50OiBDYWxlbmRhckV2ZW50KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiBldmVudC5pZCxcbiAgICAgIG5hbWU6IGV2ZW50Lm5hbWUsXG4gICAgICBzdGFydERhdGU6IGZvcm1hdChldmVudC5zdGFydERhdGUsICdZWVlZLU1NLURELCBISDptbTpzcycpLFxuICAgICAgZW5kRGF0ZTogZm9ybWF0KGV2ZW50LmVuZERhdGUsICdZWVlZLU1NLURELCBISDptbTpzcycpLFxuICAgICAgY29sb3I6IGV2ZW50LmNvbG9yLFxuICAgIH07XG4gIH1cblxuICBmb3JtYXREYXRlKGRhdGU6IERhdGUpIHtcbiAgICBjb25zdCB5ZWFyID0gZ2V0WWVhcihkYXRlKTtcbiAgICBjb25zdCBtb250aCA9IGdldE1vbnRoKGRhdGUpO1xuICAgIGNvbnN0IGRheSA9IGdldERhdGUoZGF0ZSk7XG4gIH1cblxuICBvbkRheUNsaWNrKGRheTogYW55KSB7XG4gICAgaWYgKHRoaXMuZWRpdGFibGUpIHtcbiAgICAgIHRoaXMub3BlbkFkZE1vZGFsKGRheSk7XG4gICAgfVxuICB9XG5cbiAgb25FdmVudENsaWNrKGV2ZW50OiBDYWxlbmRhckV2ZW50KSB7XG4gICAgdGhpcy5vcGVuRWRpdE1vZGFsKGV2ZW50KTtcbiAgfVxuXG4gIG9uVmlld0NoYW5nZSh2aWV3OiBzdHJpbmcpIHtcbiAgICB0aGlzLmN1cnJlbnRWaWV3ID0gdGhpcy52aWV3W3ZpZXddO1xuXG4gICAgdGhpcy52aWV3Q2hhbmdlZC5lbWl0KHZpZXcpO1xuICB9XG5cbiAgb25Nb250aENoYW5nZShldmVudDogYW55KSB7XG4gICAgdGhpcy5tb250aENoYW5nZWQuZW1pdChldmVudCk7XG4gIH1cblxuICBvbldlZWtDaGFuZ2UoZXZlbnQ6IGFueSkge1xuICAgIHRoaXMud2Vla0NoYW5nZWQuZW1pdChldmVudCk7XG4gIH1cblxuICBvbkxpc3RDaGFuZ2UoZXZlbnQ6IGFueSkge1xuICAgIHRoaXMubGlzdENoYW5nZWQuZW1pdChldmVudCk7XG4gIH1cblxuICBvcGVuQWRkTW9kYWwoZXZlbnQ6IENhbGVuZGFyRXZlbnQpIHtcbiAgICBjb25zdCBkYXRhID0ge1xuICAgICAgdGl0bGU6IHRoaXMuY2FsZW5kYXJPcHRpb25zLmV2ZW50QWRkVGl0bGUsXG4gICAgICBhY3Rpb25CdG46IHRoaXMuY2FsZW5kYXJPcHRpb25zLmV2ZW50QWRkQnRuVHh0LFxuICAgICAgY2FuY2VsQnRuOiB0aGlzLmNhbGVuZGFyT3B0aW9ucy5ldmVudENhbmNlbEJ0blR4dCxcbiAgICAgIG1vZGU6ICdhZGQnLFxuICAgICAgZWRpdGFibGU6IHRoaXMuZWRpdGFibGUsXG4gICAgICBldmVudDogdGhpcy5nZXRGb3JtYXR0ZWRFdmVudChldmVudCksXG4gICAgfTtcbiAgICB0aGlzLm1vZGFsUmVmID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhFdmVudE1vZGFsQ29tcG9uZW50LCB7IGRhdGEgfSk7XG5cbiAgICB0aGlzLm1vZGFsUmVmLmNvbnRlbnQuZXZlbnREYXRhLnBpcGUodGFrZSgxKSkuc3Vic2NyaWJlKChuZXdFdmVudDogQ2FsZW5kYXJFdmVudCkgPT4ge1xuICAgICAgdGhpcy5ldmVudEFkZGVkLmVtaXQobmV3RXZlbnQpO1xuICAgIH0pO1xuICB9XG5cbiAgb3BlbkVkaXRNb2RhbChldmVudDogQ2FsZW5kYXJFdmVudCkge1xuICAgIGNvbnN0IGRhdGEgPSB7XG4gICAgICB0aXRsZTogdGhpcy5jYWxlbmRhck9wdGlvbnMuZXZlbnRFZGl0VGl0bGUsXG4gICAgICBhY3Rpb25CdG46IHRoaXMuY2FsZW5kYXJPcHRpb25zLmV2ZW50RWRpdEJ0blR4dCxcbiAgICAgIGNhbmNlbEJ0bjogdGhpcy5jYWxlbmRhck9wdGlvbnMuZXZlbnREZWxldGVCdG5UeHQsXG4gICAgICBtb2RlOiAnZWRpdCcsXG4gICAgICBlZGl0YWJsZTogdGhpcy5lZGl0YWJsZSxcbiAgICAgIGV2ZW50OiBldmVudCxcbiAgICB9O1xuICAgIHRoaXMubW9kYWxSZWYgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KEV2ZW50TW9kYWxDb21wb25lbnQsIHsgZGF0YSB9KTtcblxuICAgIHRoaXMubW9kYWxSZWYuY29udGVudC5ldmVudERhdGEucGlwZSh0YWtlKDEpKS5zdWJzY3JpYmUoKGVkaXRlZEV2ZW50OiBDYWxlbmRhckV2ZW50KSA9PiB7XG4gICAgICB0aGlzLmV2ZW50RWRpdGVkLmVtaXQoZWRpdGVkRXZlbnQpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5tb2RhbFJlZi5jb250ZW50LmV2ZW50RGVsZXRlZC5waXBlKHRha2UoMSkpLnN1YnNjcmliZSgoZGVsZXRlZEV2ZW50OiBDYWxlbmRhckV2ZW50KSA9PiB7XG4gICAgICB0aGlzLmV2ZW50RGVsZXRlZC5lbWl0KGRlbGV0ZWRFdmVudCk7XG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==
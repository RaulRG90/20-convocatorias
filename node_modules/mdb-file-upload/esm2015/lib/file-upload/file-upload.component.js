import { Component, ViewChild, Input, Output, EventEmitter, } from '@angular/core';
import { faCloudUploadAlt, faFile, faTrashAlt } from '@fortawesome/free-solid-svg-icons';
import { FaIconLibrary } from '@fortawesome/angular-fontawesome';
export class MdbFileUploadComponent {
    constructor(library) {
        this.disabled = false;
        this.height = 200;
        this.textTranslation = {
            fileText: 'Drag and drop a file here or click',
            removeText: 'Remove',
            imageFileText: 'Drag and drop or click to replace',
        };
        this.fileAdded = new EventEmitter();
        this.fileRemoved = new EventEmitter();
        this.imageFileExtensions = ['png', 'jpg', 'jpeg', 'bmp', 'gif'];
        this.isFileAdded = false;
        this.isImageFile = false;
        this.defaultPreview = false;
        library.addIcons(faCloudUploadAlt, faFile, faTrashAlt);
    }
    get defaultFile() {
        return this._defaultFile;
    }
    set defaultFile(value) {
        if (value) {
            this._defaultFile = value;
            this._setDefaultPreview(value);
        }
    }
    _setDefaultPreview(url) {
        this.url = url;
        this.fileName = this._cleanFileName(url);
        this.defaultPreview = true;
        if (this.isImage(this.fileName)) {
            this.isImageFile = true;
        }
        else {
            this.isImageFile = false;
        }
    }
    ngOnChanges(changes) {
        if (changes['customText']) {
            const currentValue = changes['customText'].currentValue;
            Object.keys(currentValue).forEach((k) => {
                this.textTranslation[k] = currentValue[k];
            });
        }
    }
    onFilesAdded() {
        if (!this.dragging && !this.disabled) {
            const file = this.fileInput.nativeElement.files[0];
            if (file) {
                this.fileType = this.getFileType(file.name);
                this.fileName = file.name;
                this.isFileAdded = true;
                this.showPreview(file);
                this.fileAdded.emit(file);
            }
        }
    }
    onFileDrop(event) {
        if (event.dataTransfer && this.dragging && !this.disabled) {
            event.dataTransfer.dropEffect = 'copy';
            const file = event.dataTransfer.files[0];
            this.fileType = this.getFileType(file.name);
            this.fileName = file.name;
            this.showPreview(file);
        }
        this.dragging = false;
    }
    onDragOver(event) {
        if (!this.disabled) {
            this.dragging = true;
            event.preventDefault();
            event.stopPropagation();
        }
    }
    onDragLeave(event) {
        if (!this.disabled) {
            this.dragging = false;
            event.preventDefault();
            event.stopPropagation();
        }
    }
    reset() {
        if (this.isFileAdded) {
            this.removePreview();
            this.fileInput.nativeElement.value = '';
            this.fileRemoved.emit();
        }
        if (this.defaultPreview) {
            this.fileInput.nativeElement.value = '';
            this.defaultPreview = false;
        }
    }
    showPreview(file) {
        if (this.isImage(file.name)) {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => {
                this.url = reader.result;
            };
            this.isImageFile = true;
        }
        else {
            this.isImageFile = false;
        }
        if (this.defaultPreview) {
            this.defaultPreview = false;
        }
    }
    removePreview() {
        this.isFileAdded = false;
    }
    getFileType(fileName) {
        return fileName.split('.').pop().toLowerCase();
    }
    isImage(fileName) {
        return this.imageFileExtensions.indexOf(this.getFileType(fileName)) !== -1;
    }
    _cleanFileName(url) {
        return url.split('/').pop();
    }
}
MdbFileUploadComponent.decorators = [
    { type: Component, args: [{
                selector: 'mdb-file-upload',
                template: "<div class=\"mdb-file-upload-wrapper\" (drop)=\"onFileDrop($event)\" (dragover)=\"onDragOver($event)\" (dragleave)=\"onDragLeave($event)\" (click)=\"$event.stopPropagation()\">\n  <div class=\"mdb-file-upload view\" [ngClass]=\"{'disabled': disabled }\" [style.height.px]=\"height\">\n    <div class=\"upload-message\" *ngIf=\"!isFileAdded && !this.defaultPreview\">\n      <fa-icon size=\"4x\" [icon]=\"['fas','cloud-upload-alt']\"></fa-icon>\n      <p>{{textTranslation.fileText}}</p>\n    </div>\n    <div class=\"mask rgba-stylish-slight\"></div>\n    <input #fileInput type=\"file\" (change)=\"onFilesAdded()\" [disabled]=\"disabled\">\n    <button *ngIf=\"isFileAdded || this.defaultPreview\" class=\"remove-button\" (click)=\"reset()\">\n        <span>{{textTranslation.removeText}}</span>\n        <fa-icon [icon]=\"['fas', 'trash-alt']\"></fa-icon>\n    </button>\n    <div #filePreview class=\"file-preview\" *ngIf=\"isFileAdded || this.defaultPreview\">\n      <span *ngIf=\"(isFileAdded || this.defaultPreview) && isImageFile\">\n        <img class=\"file-preview-img\" src=\"{{ url }}\">\n      </span>\n\n      <span *ngIf=\"!isImageFile\" class=\"file-icon\">\n        <fa-icon size=\"5x\" [icon]=\"['fas', 'file']\"></fa-icon>\n        <span class=\"file-extension\">{{ fileType }}</span>\n      </span>\n      <div class=\"preview-message\">\n        <div class=\"preview-message-inner\">\n          <p class=\"preview-filename\">{{ fileName }}</p>\n          <p class=\"preview-description\">{{textTranslation.imageFileText}}</p>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n",
                styles: [".mdb-file-upload-wrapper{background-color:#fff;box-shadow:0 2px 5px #00000029,0 2px 10px #0000001f}.mdb-file-upload{display:flex;justify-content:center;align-items:center;position:relative;max-width:100%;overflow:hidden;color:#ccc;text-align:center}.mdb-file-upload .mask.rgba-stylish-slight{opacity:0;transition:all .15s linear}.mdb-file-upload .rgba-stylish-slight{background-color:#3e45511a}.mdb-file-upload input{position:absolute;top:0;right:0;bottom:0;left:0;height:100%;width:100%;opacity:0;cursor:pointer;z-index:5}.mdb-file-upload .upload-message{text-align:center;font-size:1rem}.mdb-file-upload .file-preview{position:absolute;top:0;right:0;bottom:0;left:0;z-index:1;overflow:hidden;text-align:center;display:flex;justify-content:center;align-items:center}.mdb-file-upload .view .mask{position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden;width:100%;height:100%;background-attachment:fixed}.mdb-file-upload .preview-message{position:absolute;left:0;top:0;right:0;bottom:0;z-index:3;background:rgba(0,0,0,.7);opacity:0;transition:opacity .15s linear}.mdb-file-upload .preview-message-inner{margin-top:-5px;position:absolute;top:50%;transform:translateY(-40%);-webkit-backface-visibility:hidden;backface-visibility:hidden;width:100%;max-width:100%;transition:all .2s ease}.mdb-file-upload .preview-filename{padding:0;margin:0;position:relative;width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:#fff;text-align:center;line-height:25px;font-weight:700}.mdb-file-upload .preview-description{margin-top:15px;padding-top:15px;font-size:14px;position:relative;opacity:.8}.mdb-file-upload .preview-description:before{content:\"\";position:absolute;top:0;left:50%;transform:translate(-50%);background:#fff;width:30px;height:2px}.mdb-file-upload .file-icon fa-icon{top:50%;left:50%;transform:translate(-50%,-50%);position:absolute;color:#777}.mdb-file-upload .file-extension{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);margin-top:10px;text-transform:uppercase;font-weight:900;font-size:1rem;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.mdb-file-upload .remove-button{opacity:0;position:absolute;top:10px;right:10px;z-index:7;cursor:pointer;padding:.5rem 1.6rem;font-size:.64rem;font-weight:400;line-height:1.5;text-align:center;-webkit-user-select:none;-moz-user-select:none;user-select:none;background-color:#ff3547;color:#fff;border:0;border-radius:.125rem;text-transform:uppercase;white-space:normal;word-wrap:break-word;box-shadow:0 2px 5px #00000029,0 2px 10px #0000001f;margin:.375rem;transition:all .15s ease}.mdb-file-upload .remove-button span{padding-right:5px}.mdb-file-upload.disabled input{cursor:not-allowed}.mdb-file-upload.disabled:hover .mask.rgba-stylish-slight{opacity:0}.mdb-file-upload.disabled .upload-message{opacity:.5;text-decoration:line-through}.mdb-file-upload.disabled .preview-description{display:none}.mdb-file-upload:hover .preview-message{opacity:1}.mdb-file-upload:hover .remove-button{opacity:1}.mdb-file-upload:hover .mask.rgba-stylish-slight{opacity:.8}.rgba-stylish-slight{background-color:#3e45511a}.view .mask{position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden;width:100%;height:100%;background-attachment:fixed}\n"]
            },] }
];
MdbFileUploadComponent.ctorParameters = () => [
    { type: FaIconLibrary }
];
MdbFileUploadComponent.propDecorators = {
    fileInput: [{ type: ViewChild, args: ['fileInput', { static: true },] }],
    disabled: [{ type: Input }],
    height: [{ type: Input }],
    defaultFile: [{ type: Input }],
    customText: [{ type: Input }],
    fileAdded: [{ type: Output }],
    fileRemoved: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZS11cGxvYWQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbWRiLWZpbGUtdXBsb2FkL3NyYy9saWIvZmlsZS11cGxvYWQvZmlsZS11cGxvYWQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsU0FBUyxFQUVULEtBQUssRUFDTCxNQUFNLEVBQ04sWUFBWSxHQUdiLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFDekYsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBYWpFLE1BQU0sT0FBTyxzQkFBc0I7SUFvQ2pDLFlBQVksT0FBc0I7UUFqQ3pCLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFDakIsV0FBTSxHQUFHLEdBQUcsQ0FBQztRQWN0QixvQkFBZSxHQUFxQjtZQUNsQyxRQUFRLEVBQUUsb0NBQW9DO1lBQzlDLFVBQVUsRUFBRSxRQUFRO1lBQ3BCLGFBQWEsRUFBRSxtQ0FBbUM7U0FDbkQsQ0FBQztRQUVRLGNBQVMsR0FBRyxJQUFJLFlBQVksRUFBUSxDQUFDO1FBQ3JDLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUVoRCx3QkFBbUIsR0FBYSxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQztRQUtyRSxnQkFBVyxHQUFHLEtBQUssQ0FBQztRQUNwQixnQkFBVyxHQUFHLEtBQUssQ0FBQztRQUNwQixtQkFBYyxHQUFHLEtBQUssQ0FBQztRQUdyQixPQUFPLENBQUMsUUFBUSxDQUFDLGdCQUFnQixFQUFFLE1BQU0sRUFBRSxVQUFVLENBQUMsQ0FBQztJQUN6RCxDQUFDO0lBakNELElBQ0ksV0FBVztRQUNiLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQztJQUMzQixDQUFDO0lBQ0QsSUFBSSxXQUFXLENBQUMsS0FBYTtRQUMzQixJQUFJLEtBQUssRUFBRTtZQUNULElBQUksQ0FBQyxZQUFZLEdBQUcsS0FBSyxDQUFDO1lBQzFCLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUNoQztJQUNILENBQUM7SUEwQk8sa0JBQWtCLENBQUMsR0FBVztRQUNwQyxJQUFJLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQztRQUNmLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN6QyxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQztRQUUzQixJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQy9CLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO1NBQ3pCO2FBQU07WUFDTCxJQUFJLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQztTQUMxQjtJQUNILENBQUM7SUFFRCxXQUFXLENBQUMsT0FBc0I7UUFDaEMsSUFBSSxPQUFPLENBQUMsWUFBWSxDQUFDLEVBQUU7WUFDekIsTUFBTSxZQUFZLEdBQUcsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDLFlBQVksQ0FBQztZQUV4RCxNQUFNLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFO2dCQUN0QyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxHQUFHLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM1QyxDQUFDLENBQUMsQ0FBQztTQUNKO0lBQ0gsQ0FBQztJQUVELFlBQVk7UUFDVixJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDcEMsTUFBTSxJQUFJLEdBQVMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3pELElBQUksSUFBSSxFQUFFO2dCQUNSLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzVDLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztnQkFDMUIsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7Z0JBRXhCLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBRXZCLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQzNCO1NBQ0Y7SUFDSCxDQUFDO0lBRUQsVUFBVSxDQUFDLEtBQVU7UUFDbkIsSUFBSSxLQUFLLENBQUMsWUFBWSxJQUFJLElBQUksQ0FBQyxRQUFRLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ3pELEtBQUssQ0FBQyxZQUFZLENBQUMsVUFBVSxHQUFHLE1BQU0sQ0FBQztZQUN2QyxNQUFNLElBQUksR0FBUyxLQUFLLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMvQyxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzVDLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztZQUMxQixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ3hCO1FBQ0QsSUFBSSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUM7SUFDeEIsQ0FBQztJQUVELFVBQVUsQ0FBQyxLQUFVO1FBQ25CLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2xCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO1lBQ3JCLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztZQUN2QixLQUFLLENBQUMsZUFBZSxFQUFFLENBQUM7U0FDekI7SUFDSCxDQUFDO0lBRUQsV0FBVyxDQUFDLEtBQVU7UUFDcEIsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDbEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUM7WUFDdEIsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO1lBQ3ZCLEtBQUssQ0FBQyxlQUFlLEVBQUUsQ0FBQztTQUN6QjtJQUNILENBQUM7SUFFRCxLQUFLO1FBQ0gsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ3BCLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUNyQixJQUFJLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDO1lBQ3hDLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxFQUFFLENBQUM7U0FDekI7UUFFRCxJQUFJLElBQUksQ0FBQyxjQUFjLEVBQUU7WUFDdkIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztZQUN4QyxJQUFJLENBQUMsY0FBYyxHQUFHLEtBQUssQ0FBQztTQUM3QjtJQUNILENBQUM7SUFFRCxXQUFXLENBQUMsSUFBUztRQUNuQixJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQzNCLE1BQU0sTUFBTSxHQUFHLElBQUksVUFBVSxFQUFFLENBQUM7WUFDaEMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUMzQixNQUFNLENBQUMsTUFBTSxHQUFHLEdBQUcsRUFBRTtnQkFDbkIsSUFBSSxDQUFDLEdBQUcsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDO1lBQzNCLENBQUMsQ0FBQztZQUNGLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO1NBQ3pCO2FBQU07WUFDTCxJQUFJLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQztTQUMxQjtRQUVELElBQUksSUFBSSxDQUFDLGNBQWMsRUFBRTtZQUN2QixJQUFJLENBQUMsY0FBYyxHQUFHLEtBQUssQ0FBQztTQUM3QjtJQUNILENBQUM7SUFFRCxhQUFhO1FBQ1gsSUFBSSxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUM7SUFDM0IsQ0FBQztJQUVELFdBQVcsQ0FBQyxRQUFnQjtRQUMxQixPQUFPLFFBQVEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDakQsQ0FBQztJQUVELE9BQU8sQ0FBQyxRQUFnQjtRQUN0QixPQUFPLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0lBQzdFLENBQUM7SUFFTyxjQUFjLENBQUMsR0FBVztRQUNoQyxPQUFPLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7SUFDOUIsQ0FBQzs7O1lBekpGLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsaUJBQWlCO2dCQUMzQixxbERBQTJDOzthQUU1Qzs7O1lBWlEsYUFBYTs7O3dCQWNuQixTQUFTLFNBQUMsV0FBVyxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTt1QkFFdkMsS0FBSztxQkFDTCxLQUFLOzBCQUNMLEtBQUs7eUJBV0wsS0FBSzt3QkFRTCxNQUFNOzBCQUNOLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIFZpZXdDaGlsZCxcbiAgRWxlbWVudFJlZixcbiAgSW5wdXQsXG4gIE91dHB1dCxcbiAgRXZlbnRFbWl0dGVyLFxuICBPbkNoYW5nZXMsXG4gIFNpbXBsZUNoYW5nZXMsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgZmFDbG91ZFVwbG9hZEFsdCwgZmFGaWxlLCBmYVRyYXNoQWx0IH0gZnJvbSAnQGZvcnRhd2Vzb21lL2ZyZWUtc29saWQtc3ZnLWljb25zJztcbmltcG9ydCB7IEZhSWNvbkxpYnJhcnkgfSBmcm9tICdAZm9ydGF3ZXNvbWUvYW5ndWxhci1mb250YXdlc29tZSc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSVRleHRUcmFuc2xhdGlvbiB7XG4gIGZpbGVUZXh0Pzogc3RyaW5nO1xuICByZW1vdmVUZXh0Pzogc3RyaW5nO1xuICBpbWFnZUZpbGVUZXh0Pzogc3RyaW5nO1xufVxuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdtZGItZmlsZS11cGxvYWQnLFxuICB0ZW1wbGF0ZVVybDogJy4vZmlsZS11cGxvYWQuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9maWxlLXVwbG9hZC5jb21wb25lbnQuc2NzcyddLFxufSlcbmV4cG9ydCBjbGFzcyBNZGJGaWxlVXBsb2FkQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzIHtcbiAgQFZpZXdDaGlsZCgnZmlsZUlucHV0JywgeyBzdGF0aWM6IHRydWUgfSkgZmlsZUlucHV0OiBFbGVtZW50UmVmO1xuXG4gIEBJbnB1dCgpIGRpc2FibGVkID0gZmFsc2U7XG4gIEBJbnB1dCgpIGhlaWdodCA9IDIwMDtcbiAgQElucHV0KClcbiAgZ2V0IGRlZmF1bHRGaWxlKCkge1xuICAgIHJldHVybiB0aGlzLl9kZWZhdWx0RmlsZTtcbiAgfVxuICBzZXQgZGVmYXVsdEZpbGUodmFsdWU6IHN0cmluZykge1xuICAgIGlmICh2YWx1ZSkge1xuICAgICAgdGhpcy5fZGVmYXVsdEZpbGUgPSB2YWx1ZTtcbiAgICAgIHRoaXMuX3NldERlZmF1bHRQcmV2aWV3KHZhbHVlKTtcbiAgICB9XG4gIH1cbiAgcHJpdmF0ZSBfZGVmYXVsdEZpbGU6IHN0cmluZztcbiAgQElucHV0KCkgY3VzdG9tVGV4dDogSVRleHRUcmFuc2xhdGlvbjtcblxuICB0ZXh0VHJhbnNsYXRpb246IElUZXh0VHJhbnNsYXRpb24gPSB7XG4gICAgZmlsZVRleHQ6ICdEcmFnIGFuZCBkcm9wIGEgZmlsZSBoZXJlIG9yIGNsaWNrJyxcbiAgICByZW1vdmVUZXh0OiAnUmVtb3ZlJyxcbiAgICBpbWFnZUZpbGVUZXh0OiAnRHJhZyBhbmQgZHJvcCBvciBjbGljayB0byByZXBsYWNlJyxcbiAgfTtcblxuICBAT3V0cHV0KCkgZmlsZUFkZGVkID0gbmV3IEV2ZW50RW1pdHRlcjxGaWxlPigpO1xuICBAT3V0cHV0KCkgZmlsZVJlbW92ZWQgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICBpbWFnZUZpbGVFeHRlbnNpb25zOiBzdHJpbmdbXSA9IFsncG5nJywgJ2pwZycsICdqcGVnJywgJ2JtcCcsICdnaWYnXTtcbiAgdXJsOiBzdHJpbmcgfCBBcnJheUJ1ZmZlcjtcbiAgZmlsZVR5cGU6IHN0cmluZztcbiAgZmlsZU5hbWU6IHN0cmluZztcbiAgZHJhZ2dpbmc6IGJvb2xlYW47XG4gIGlzRmlsZUFkZGVkID0gZmFsc2U7XG4gIGlzSW1hZ2VGaWxlID0gZmFsc2U7XG4gIGRlZmF1bHRQcmV2aWV3ID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IobGlicmFyeTogRmFJY29uTGlicmFyeSkge1xuICAgIGxpYnJhcnkuYWRkSWNvbnMoZmFDbG91ZFVwbG9hZEFsdCwgZmFGaWxlLCBmYVRyYXNoQWx0KTtcbiAgfVxuXG4gIHByaXZhdGUgX3NldERlZmF1bHRQcmV2aWV3KHVybDogc3RyaW5nKSB7XG4gICAgdGhpcy51cmwgPSB1cmw7XG4gICAgdGhpcy5maWxlTmFtZSA9IHRoaXMuX2NsZWFuRmlsZU5hbWUodXJsKTtcbiAgICB0aGlzLmRlZmF1bHRQcmV2aWV3ID0gdHJ1ZTtcblxuICAgIGlmICh0aGlzLmlzSW1hZ2UodGhpcy5maWxlTmFtZSkpIHtcbiAgICAgIHRoaXMuaXNJbWFnZUZpbGUgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmlzSW1hZ2VGaWxlID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIGlmIChjaGFuZ2VzWydjdXN0b21UZXh0J10pIHtcbiAgICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IGNoYW5nZXNbJ2N1c3RvbVRleHQnXS5jdXJyZW50VmFsdWU7XG5cbiAgICAgIE9iamVjdC5rZXlzKGN1cnJlbnRWYWx1ZSkuZm9yRWFjaCgoaykgPT4ge1xuICAgICAgICB0aGlzLnRleHRUcmFuc2xhdGlvbltrXSA9IGN1cnJlbnRWYWx1ZVtrXTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIG9uRmlsZXNBZGRlZCgpIHtcbiAgICBpZiAoIXRoaXMuZHJhZ2dpbmcgJiYgIXRoaXMuZGlzYWJsZWQpIHtcbiAgICAgIGNvbnN0IGZpbGU6IEZpbGUgPSB0aGlzLmZpbGVJbnB1dC5uYXRpdmVFbGVtZW50LmZpbGVzWzBdO1xuICAgICAgaWYgKGZpbGUpIHtcbiAgICAgICAgdGhpcy5maWxlVHlwZSA9IHRoaXMuZ2V0RmlsZVR5cGUoZmlsZS5uYW1lKTtcbiAgICAgICAgdGhpcy5maWxlTmFtZSA9IGZpbGUubmFtZTtcbiAgICAgICAgdGhpcy5pc0ZpbGVBZGRlZCA9IHRydWU7XG5cbiAgICAgICAgdGhpcy5zaG93UHJldmlldyhmaWxlKTtcblxuICAgICAgICB0aGlzLmZpbGVBZGRlZC5lbWl0KGZpbGUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG9uRmlsZURyb3AoZXZlbnQ6IGFueSkge1xuICAgIGlmIChldmVudC5kYXRhVHJhbnNmZXIgJiYgdGhpcy5kcmFnZ2luZyAmJiAhdGhpcy5kaXNhYmxlZCkge1xuICAgICAgZXZlbnQuZGF0YVRyYW5zZmVyLmRyb3BFZmZlY3QgPSAnY29weSc7XG4gICAgICBjb25zdCBmaWxlOiBGaWxlID0gZXZlbnQuZGF0YVRyYW5zZmVyLmZpbGVzWzBdO1xuICAgICAgdGhpcy5maWxlVHlwZSA9IHRoaXMuZ2V0RmlsZVR5cGUoZmlsZS5uYW1lKTtcbiAgICAgIHRoaXMuZmlsZU5hbWUgPSBmaWxlLm5hbWU7XG4gICAgICB0aGlzLnNob3dQcmV2aWV3KGZpbGUpO1xuICAgIH1cbiAgICB0aGlzLmRyYWdnaW5nID0gZmFsc2U7XG4gIH1cblxuICBvbkRyYWdPdmVyKGV2ZW50OiBhbnkpIHtcbiAgICBpZiAoIXRoaXMuZGlzYWJsZWQpIHtcbiAgICAgIHRoaXMuZHJhZ2dpbmcgPSB0cnVlO1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIH1cbiAgfVxuXG4gIG9uRHJhZ0xlYXZlKGV2ZW50OiBhbnkpIHtcbiAgICBpZiAoIXRoaXMuZGlzYWJsZWQpIHtcbiAgICAgIHRoaXMuZHJhZ2dpbmcgPSBmYWxzZTtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9XG4gIH1cblxuICByZXNldCgpIHtcbiAgICBpZiAodGhpcy5pc0ZpbGVBZGRlZCkge1xuICAgICAgdGhpcy5yZW1vdmVQcmV2aWV3KCk7XG4gICAgICB0aGlzLmZpbGVJbnB1dC5uYXRpdmVFbGVtZW50LnZhbHVlID0gJyc7XG4gICAgICB0aGlzLmZpbGVSZW1vdmVkLmVtaXQoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5kZWZhdWx0UHJldmlldykge1xuICAgICAgdGhpcy5maWxlSW5wdXQubmF0aXZlRWxlbWVudC52YWx1ZSA9ICcnO1xuICAgICAgdGhpcy5kZWZhdWx0UHJldmlldyA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHNob3dQcmV2aWV3KGZpbGU6IGFueSkge1xuICAgIGlmICh0aGlzLmlzSW1hZ2UoZmlsZS5uYW1lKSkge1xuICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpO1xuICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgdGhpcy51cmwgPSByZWFkZXIucmVzdWx0O1xuICAgICAgfTtcbiAgICAgIHRoaXMuaXNJbWFnZUZpbGUgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmlzSW1hZ2VGaWxlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZGVmYXVsdFByZXZpZXcpIHtcbiAgICAgIHRoaXMuZGVmYXVsdFByZXZpZXcgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICByZW1vdmVQcmV2aWV3KCkge1xuICAgIHRoaXMuaXNGaWxlQWRkZWQgPSBmYWxzZTtcbiAgfVxuXG4gIGdldEZpbGVUeXBlKGZpbGVOYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBmaWxlTmFtZS5zcGxpdCgnLicpLnBvcCgpLnRvTG93ZXJDYXNlKCk7XG4gIH1cblxuICBpc0ltYWdlKGZpbGVOYW1lOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5pbWFnZUZpbGVFeHRlbnNpb25zLmluZGV4T2YodGhpcy5nZXRGaWxlVHlwZShmaWxlTmFtZSkpICE9PSAtMTtcbiAgfVxuXG4gIHByaXZhdGUgX2NsZWFuRmlsZU5hbWUodXJsOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiB1cmwuc3BsaXQoJy8nKS5wb3AoKTtcbiAgfVxufVxuIl19